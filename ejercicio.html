<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Ejercicio</title>
  <style>
    body { font-family: Arial, sans-serif; margin:0; background:#f4f6f8; }
    header { background:#007bff; color:white; padding:1rem; text-align:center; }
    .container { max-width:800px; margin:20px auto; background:white; padding:20px; border-radius:8px; box-shadow:0 0 10px rgba(0,0,0,0.1); }
    img { width:100%; opacity:0.3; border-radius:8px; margin-top:15px; }
    ul { list-style: disc; margin-left:20px; font-style:italic; }
    table { width:100%; margin-top:15px; border-collapse: collapse; }
    th, td { border:1px solid #ccc; padding:8px; text-align:center; }
    th { background:#f0f0f0; }
    .form-row { margin-top:15px; display:flex; gap:10px; }
    input { flex:1; padding:8px; }
    button { background:#007bff; color:white; padding:10px; border:none; border-radius:5px; cursor:pointer; }
    .volver { margin-top:15px; }
  </style>
</head>
<body>
  <header>
    <h2 id="fecha"></h2>
    <h3 id="titulo"></h3>
  </header>
  <div class="container">
    <ul id="detalle"></ul>
    <img id="imagen" src="" alt="">
    <table>
      <thead>
        <tr id="fechas-row"></tr>
      </thead>
      <tbody>
        <tr id="peso-row"></tr>
        <tr id="reps-row"></tr>
      </tbody>
    </table>
    <div class="form-row">
      <input type="number" id="peso" placeholder="Peso (kg)">
      <input type="number" id="reps" placeholder="Repeticiones">
      <button onclick="guardarDatos()">Guardar</button>
    </div>
    <button class="volver" onclick="window.location='index.html'">Volver al calendario</button>
    <button class="volver" onclick="window.history.back()">Volver a rutinas</button>
  </div>

  <script>
    const params=new URLSearchParams(window.location.search);
    const fecha=params.get('fecha');
    const rutina=params.get('rutina');

    const rutinasData=[
      { titulo:"Pecho, bíceps y abdominales", detalle:[
        "Press de banca con barra",
        "Aperturas en banco inclinado con mancuernas",
        "Press inclinado con mancuernas",
        "Curl de bíceps con barra",
        "Crunch en máquina con carga alta"
      ], img:"https://source.unsplash.com/600x400/?bench-press" },
      { titulo:"Espalda y tríceps", detalle:[
        "Dominadas en barra fija",
        "Remo con barra",
        "Press francés",
        "Extensiones de tríceps en polea alta",
        "Fondos de tríceps"
      ], img:"https://source.unsplash.com/600x400/?pullup" },
      { titulo:"Hombros, trapecio y piernas", detalle:[
        "Elevaciones laterales con mancuernas",
        "Trapecios con polea baja",
        "Sentadillas con barra",
        "Extensiones de piernas",
        "Peso muerto con barra",
        "Gemelo en máquina"
      ], img:"https://source.unsplash.com/600x400/?squat" },
      { titulo:"Pecho y bíceps", detalle:[
        "Press de banca con mancuernas",
        "Press declinado con mancuernas",
        "Curl de bíceps sentado con mancuerna",
        "Curl de bíceps"
      ], img:"https://source.unsplash.com/600x400/?gym" },
      { titulo:"Espalda y tríceps", detalle:[
        "Remo en polea baja",
        "Peso muerto",
        "Extensión vertical alterna con mancuerna",
        "Flexiones de tríceps"
      ], img:"https://source.unsplash.com/600x400/?lat-pulldown" },
      { titulo:"Rodillas", detalle:[
        "Sentadillas",
        "Elevación de piernas",
        "Ejercicios isométricos"
      ], img:"https://source.unsplash.com/600x400/?leg" },
    ];

    const [y,m,d]=fecha.split('-');
    document.getElementById('fecha').textContent=`${d}-${m}-${y}`;
    document.getElementById('titulo').textContent=rutinasData[rutina].titulo;

    const ul=document.getElementById('detalle');
    rutinasData[rutina].detalle.forEach(t=>{
      const li=document.createElement('li');
      li.textContent=t;
      ul.appendChild(li);
    });

    document.getElementById('imagen').src=rutinasData[rutina].img;

    const data=JSON.parse(localStorage.getItem('gymData')||'{}');
    if(!data[fecha]) data[fecha]={};

    const rutinaKey=`rutina${rutina}`;
    if(!data[fecha][rutinaKey]) data[fecha][rutinaKey]={};

    const historial = {};
    for (const key in data){
      if(data[key][rutinaKey]){
        historial[key]=data[key][rutinaKey];
      }
    }

    const fechasOrdenadas = Object.keys(historial).sort((a,b)=>new Date(a)-new Date(b));
    const fechasRow=document.getElementById('fechas-row');
    const pesoRow=document.getElementById('peso-row');
    const repsRow=document.getElementById('reps-row');

    fechasRow.innerHTML='<th>Día</th>';
    pesoRow.innerHTML='<td>Peso</td>';
    repsRow.innerHTML='<td>Repeticiones</td>';

    let totalPeso=0, totalReps=0, count=0;

    fechasOrdenadas.forEach(key=>{
      const [yy,mm,dd]=key.split('-');
      fechasRow.innerHTML+=`<th>${dd}-${mm}-${yy}</th>`;
      pesoRow.innerHTML+=`<td>${historial[key].peso||'-'}</td>`;
      repsRow.innerHTML+=`<td>${historial[key].reps||'-'}</td>`;
      if(historial[key].peso){
        totalPeso+=Number(historial[key].peso);
        count++;
      }
      if(historial[key].reps){
        totalReps+=Number(historial[key].reps);
      }
    });

    if(count>0){
      fechasRow.innerHTML+=`<th>Resumen</th>`;
      pesoRow.innerHTML+=`<td>${(totalPeso/count).toFixed(2)}</td>`;
      repsRow.innerHTML+=`<td>${(totalReps/count).toFixed(0)}</td>`;
    }

    function guardarDatos(){
      const peso=document.getElementById('peso').value;
      const reps=document.getElementById('reps').value;
      data[fecha][rutinaKey]={ peso, reps };
      localStorage.setItem('gymData',JSON.stringify(data));
      alert('✅ Datos guardados correctamente');
      location.reload();
    }
  </script>
</body>
</html>
