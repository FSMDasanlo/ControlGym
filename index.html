<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Control Gym - Calendario</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #00c6ff, #0072ff);
      color: #fff;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    h1 { margin-top: 20px; }
    .controls { margin: 15px; }
    select {
      padding: 8px;
      margin: 5px;
      font-size: 16px;
      border-radius: 5px;
      border: none;
    }
    table {
      margin: 0 auto;
      border-collapse: collapse;
      background: white;
      color: black;
      border-radius: 10px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0,0,0,0.2);
      width: 95%;
      max-width: 500px;
    }
    th, td {
      width: 14.28%;
      height: 45px;
      text-align: center;
      border: 1px solid #ddd;
      font-size: 14px;
      cursor: pointer;
    }
    th { background-color: #f50057; color: white; font-size: 13px; }
    td:hover { background-color: #ffeb3b; }
    .empty { background: #f1f1f1; cursor: default; }
  </style>
</head>
<body>
  <h1>Calendario</h1>
  <div class="controls">
    <select id="mes"></select>
    <select id="anio"></select>
  </div>
  <div id="calendario"></div>

  <script>
    const mesSelect = document.getElementById('mes');
    const anioSelect = document.getElementById('anio');
    const calendarioDiv = document.getElementById('calendario');

    const meses = ["Enero","Febrero","Marzo","Abril","Mayo","Junio",
                   "Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];
    meses.forEach((m, i) => {
      const option = document.createElement('option');
      option.value = i;
      option.textContent = m;
      mesSelect.appendChild(option);
    });

    const añoActual = new Date().getFullYear();
    for (let a = añoActual - 5; a <= añoActual + 5; a++) {
      const option = document.createElement('option');
      option.value = a;
      option.textContent = a;
      anioSelect.appendChild(option);
    }

    let mesActual = new Date().getMonth();
    let anioActual = añoActual;
    mesSelect.value = mesActual;
    anioSelect.value = anioActual;

    mesSelect.addEventListener('change', () => { mesActual = parseInt(mesSelect.value); mostrarCalendario(); });
    anioSelect.addEventListener('change', () => { anioActual = parseInt(anioSelect.value); mostrarCalendario(); });

    function mostrarCalendario() {
      const diasSemana = ["Lun","Mar","Mié","Jue","Vie","Sáb","Dom"];
      let primerDia = new Date(anioActual, mesActual, 1).getDay();
      primerDia = (primerDia + 6) % 7;
      const ultimoDia = new Date(anioActual, mesActual + 1, 0).getDate();
      const data = JSON.parse(localStorage.getItem('entrenamientos') || '{}');

      let tabla = "<table><tr>";
      for (const d of diasSemana) tabla += `<th>${d}</th>`;
      tabla += "</tr><tr>";

      for (let i = 0; i < primerDia; i++) tabla += "<td class='empty'></td>";

      for (let dia = 1; dia <= ultimoDia; dia++) {
        const fechaISO = `${anioActual}-${String(mesActual+1).padStart(2,'0')}-${String(dia).padStart(2,'0')}`;
        let check = '';
        if (data[fechaISO]) {
          const ejercicios = data[fechaISO];
          const tieneDatos = ejercicios.some(e =>
            e.tiempo.trim() !== '?' ||
            e.peso.trim() !== '?' ||
            e.repeticiones.trim() !== '?' ||
            e.libre.trim() !== '?'
          );
          if (tieneDatos) check = ' ✅';
        }
        if ((primerDia + dia - 1) % 7 === 0 && dia !== 1) tabla += "</tr><tr>";
        tabla += `<td onclick="window.location.href='dia.html?fecha=${fechaISO}'">${dia}${check}</td>`;
      }

      tabla += "</tr></table>";
      calendarioDiv.innerHTML = tabla;
    }

    mostrarCalendario();
  </script>
</body>
</html>
