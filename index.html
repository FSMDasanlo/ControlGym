<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Control Gym</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background: #f4f6f8;
    }
    header {
      background: #007bff;
      color: white;
      padding: 1rem;
      text-align: center;
    }
    .calendar {
      max-width: 500px;
      margin: 20px auto;
      background: white;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    table {
      width: 100%;
      border-collapse: collapse;
    }
    th {
      background: #007bff;
      color: white;
      padding: 5px;
    }
    td {
      width: 14.28%;
      text-align: center;
      padding: 10px;
      cursor: pointer;
    }
    td:hover {
      background: #e9ecef;
    }
    .check {
      color: green;
      font-weight: bold;
      margin-left: 5px;
    }
    select {
      padding: 5px;
      margin: 10px;
      font-size: 1rem;
    }
    .stats-btn {
      display: block;
      margin: 20px auto 0;
      padding: 10px 20px;
      background: #007bff;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <header>
    <h1>Control Gym</h1>
  </header>

  <div class="calendar">
    <div style="text-align:center;">
      <select id="month"></select>
      <select id="year"></select>
    </div>
    <table>
      <thead>
        <tr>
          <th>L</th>
          <th>M</th>
          <th>X</th>
          <th>J</th>
          <th>V</th>
          <th>S</th>
          <th>D</th>
        </tr>
      </thead>
      <tbody id="calendar-body"></tbody>
    </table>
  </div>

  <script>
    const monthSelect = document.getElementById('month');
    const yearSelect = document.getElementById('year');
    const calendarBody = document.getElementById('calendar-body');

    const months = [
      'Enero','Febrero','Marzo','Abril','Mayo','Junio',
      'Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'
    ];

    for (let i=0;i<12;i++){
      let opt=document.createElement('option');
      opt.value=i;
      opt.textContent=months[i];
      monthSelect.appendChild(opt);
    }

    const currentYear=new Date().getFullYear();
    for (let y=currentYear-5;y<=currentYear+5;y++){
      let opt=document.createElement('option');
      opt.value=y;
      opt.textContent=y;
      yearSelect.appendChild(opt);
    }

    function formatDateToKey(date){
      const d=String(date.getDate()).padStart(2,'0');
      const m=String(date.getMonth()+1).padStart(2,'0');
      const y=date.getFullYear();
      return `${y}-${m}-${d}`;
    }

    function formatDateToSpanish(key){
      const [y,m,d]=key.split('-');
      return `${d}-${m}-${y}`;
    }

    function generateCalendar(month,year){
      calendarBody.innerHTML='';
      const firstDay=(new Date(year,month,1).getDay()+6)%7; 
      const daysInMonth=new Date(year,month+1,0).getDate();
      let date=1;

      for (let i=0;i<6;i++){
        const row=document.createElement('tr');
        for (let j=0;j<7;j++){
          const cell=document.createElement('td');
          if (i===0 && j<firstDay){
            cell.textContent='';
          } else if (date>daysInMonth){
            cell.textContent='';
          } else {
            const key=`${year}-${String(month+1).padStart(2,'0')}-${String(date).padStart(2,'0')}`;
            cell.textContent=date;
            cell.addEventListener('click',()=>window.location=`rutinas.html?fecha=${key}`);

            const data=JSON.parse(localStorage.getItem('gymData')||'{}');
            if(data[key]) {
              const check=document.createElement('span');
              check.textContent='âœ”';
              check.className='check';
              cell.appendChild(check);
            }
            date++;
          }
          row.appendChild(cell);
        }
        calendarBody.appendChild(row);
      }
    }

    monthSelect.value=new Date().getMonth();
    yearSelect.value=new Date().getFullYear();

    monthSelect.addEventListener('change',()=>generateCalendar(+monthSelect.value,+yearSelect.value));
    yearSelect.addEventListener('change',()=>generateCalendar(+monthSelect.value,+yearSelect.value));

    generateCalendar(new Date().getMonth(),new Date().getFullYear());
  </script>
</body>
</html>
