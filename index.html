<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Control Gym</title>
  <style>
    body { font-family: Arial, sans-serif; background:#f5f5f5; margin:0; padding:0; text-align:center;}
    h1 { color:#333; margin-top:20px;}
    #controls { margin: 20px 0; }
    select { padding:5px; margin:0 5px; font-size:16px; }
    table { margin: 0 auto; border-collapse: collapse; }
    th, td { padding: 10px; border: 1px solid #ccc; text-align: center; }
    th { background:#eee; }
    td.check::after {
      content: "✔️";
      color: green;
    }
    button { padding:10px 20px; margin-top:20px; font-size:16px; background:#28a745; color:white; border:none; border-radius:5px; cursor:pointer;}
  </style>
</head>
<body>
  <h1>Control Gym</h1>
  <div id="controls">
    <select id="mes"></select>
    <select id="anio"></select>
  </div>
  <div id="calendario"></div>

  <script>
    const hoy = new Date();
    const mesSelect = document.getElementById('mes');
    const anioSelect = document.getElementById('anio');
    const calendarioDiv = document.getElementById('calendario');

    for(let m=0;m<12;m++){
      const opt = document.createElement('option');
      opt.value = m;
      opt.textContent = new Date(2000,m).toLocaleString('es-ES',{month:'long'});
      if(m===hoy.getMonth()) opt.selected=true;
      mesSelect.appendChild(opt);
    }

    const añoActual = hoy.getFullYear();
    for(let a=añoActual-2;a<=añoActual+2;a++){
      const opt = document.createElement('option');
      opt.value = a;
      opt.textContent = a;
      if(a===añoActual) opt.selected=true;
      anioSelect.appendChild(opt);
    }

    mesSelect.addEventListener('change',renderCalendar);
    anioSelect.addEventListener('change',renderCalendar);

    function formatearFechaISO(fecha){
      const [año, mes, dia] = fecha.split("-");
      return `${dia}-${mes}-${año}`;
    }

    function renderCalendar(){
      const mes = parseInt(mesSelect.value);
      const anio = parseInt(anioSelect.value);
      const primerDia = new Date(anio,mes,1);
      const ultimoDia = new Date(anio,mes+1,0);
      const inicio = (primerDia.getDay()+6)%7;
      const tabla = document.createElement('table');
      const encabezado = tabla.insertRow();
      ['Lun','Mar','Mié','Jue','Vie','Sáb','Dom'].forEach(d=>{
        const th = document.createElement('th');
        th.textContent = d;
        encabezado.appendChild(th);
      });

      let fila = tabla.insertRow();
      for(let i=0;i<inicio;i++) fila.insertCell();

      const registros = JSON.parse(localStorage.getItem('gymData')||'{}');

      for(let d=1; d<=ultimoDia.getDate(); d++){
        if(fila.cells.length===7) fila = tabla.insertRow();
        const celda = fila.insertCell();
        celda.textContent=d;
        const fechaISO = `${anio}-${String(mes+1).padStart(2,'0')}-${String(d).padStart(2,'0')}`;
        if(registros[fechaISO]) celda.classList.add('check');
        celda.style.cursor='pointer';
        celda.onclick=()=>{
          window.location.href=`rutinas.html?fecha=${fechaISO}`;
        };
      }

      calendarioDiv.innerHTML='';
      calendarioDiv.appendChild(tabla);
    }

    renderCalendar();
  </script>
</body>
</html>
